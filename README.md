# 3連複期待リターン計算ツール

競馬の3連複馬券の期待リターンを理論的に計算・分析するWebアプリケーション。

**[Demo](https://keiba-six.vercel.app/)**

![トップ画面](public/images/トップ.png)

## 開発動機

競馬の3連複は組み合わせ数が膨大で、直感的な判断だけでは合理的な買い目を組み立てにくい。「単勝オッズから3連複の理論オッズを逆算し、各組み合わせの期待リターンを数値化できれば、より根拠のある意思決定ができるのでは？」という仮説を検証するために開発した。

計算の結果、**どのような重み配分でも期待値は必ず0.75（控除率25%）に収束する**ことを数学的に証明。この結論自体がツールの教育的価値となっている。

## 技術スタック

| カテゴリ | 技術 |
|---------|------|
| フレームワーク | Next.js 14 (App Router) |
| 言語 | TypeScript |
| スタイリング | Tailwind CSS + shadcn/ui |
| 数式レンダリング | KaTeX (react-katex) |
| データ取得 | TanStack Query + Axios |
| スクレイピング | Cheerio (サーバーサイド) |
| ホスティング | Vercel |

## 技術的なポイント

### サーバーサイドスクレイピング
Next.js API Routesを使い、keibalab.jpから重賞レースのオッズをリアルタイムに取得。`Cache-Control`ヘッダーによるHTTPキャッシュで、外部サイトへの負荷を抑制しつつレスポンスを高速化。

### 期待値計算アルゴリズム
単勝オッズから3着以内確率を推定し、3頭の組み合わせごとに理論オッズ・期待リターンを算出。難易度加重により「当たりやすさ」も加味した評価指標を提供。

### 最適化探索
全重みパターンを全探索し、期待リターンが最大となる重み配分を自動で算出。非同期処理でUIをブロックせず、進捗をリアルタイム表示。

### コンポーネント設計
1715行のモノリスを17ファイルに分割。純粋関数（計算ロジック）・カスタムHooks（状態管理）・UIコンポーネントの3層に分離し、テスタビリティと保守性を確保。

```
src/
├── lib/calculator/     # 純粋関数（型定義・組み合わせ生成・計算・最適化）
├── hooks/              # カスタムHooks（状態管理・データ取得・メディアクエリ）
└── components/calculator/  # UIコンポーネント（10個）+ オーケストレーター
```

![シミュレーション画面](public/images/シミュレーション.png)

## ローカル開発

```bash
npm install
npm run dev
# http://localhost:3000
```
